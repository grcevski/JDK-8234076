<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta charset="utf-8">
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
a.print { font-size: x-small; }

</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

<title>jdk Sdiff test/jdk/tools/launcher/modules/basic </title>
</head><body id="SUNWwebrev">
<center><a href='../../../../../../src/java.base/windows/native/libjli/java_md.c.sdiff.html' target='_top'>&lt prev</a> <a href='../../../../../../index.html' target='_top'>index</a> next &gt</center>
<h2>test/jdk/tools/launcher/modules/basic/BasicTest.java</h2>
<a class="print" href="javascript:print()">Print this page</a>
<pre></pre>

<table><tr valign="top">
<td><pre>

</pre><hr></hr><pre>
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 /**
  25  * @test
  26  * @library /test/lib
  27  * @modules jdk.compiler
  28  *          jdk.jartool
  29  *          jdk.jlink
  30  * @build BasicTest jdk.test.lib.compiler.CompilerUtils
  31  * @run testng BasicTest

  32  * @summary Basic test of starting an application as a module
  33  */
  34 
  35 import java.io.File;
  36 import java.nio.file.Files;
  37 import java.nio.file.Path;
  38 import java.nio.file.Paths;
  39 import java.util.spi.ToolProvider;
  40 
  41 import jdk.test.lib.compiler.CompilerUtils;
  42 import jdk.test.lib.process.ProcessTools;

  43 
  44 import org.testng.annotations.BeforeTest;
  45 import org.testng.annotations.Test;
  46 import static org.testng.Assert.*;
  47 
  48 
  49 @Test
  50 public class BasicTest {
  51     private static final ToolProvider JAR_TOOL = ToolProvider.findFirst("jar")
  52         .orElseThrow(() -&gt;
  53             new RuntimeException("jar tool not found")
  54         );
  55     private static final ToolProvider JMOD_TOOL = ToolProvider.findFirst("jmod")
  56         .orElseThrow(() -&gt;
  57             new RuntimeException("jmod tool not found")
  58         );
  59 
  60     private static final Path USER_DIR = Paths.get(System.getProperty("user.dir"));
  61 
  62     private static final String TEST_SRC = System.getProperty("test.src");
  63 
  64     private static final Path SRC_DIR = Paths.get(TEST_SRC, "src");
  65     private static final Path MODS_DIR = Paths.get("mods");
  66 
  67     // the module name of the test module
  68     private static final String TEST_MODULE = "test";
  69 
  70     // the module main class
  71     private static final String MAIN_CLASS = "jdk.test.Main";
  72 


  73 
  74     @BeforeTest
  75     public void compileTestModule() throws Exception {
  76 
  77         // javac -d mods/$TESTMODULE src/$TESTMODULE/**
  78         boolean compiled
  79             = CompilerUtils.compile(SRC_DIR.resolve(TEST_MODULE),
  80                                     MODS_DIR.resolve(TEST_MODULE));
  81 
  82         assertTrue(compiled, "test module did not compile");
  83     }
  84 
  85     /**
  86      * Execute "java" with the given arguments, returning the exit code.
  87      */
  88     private int exec(String... args) throws Exception {
  89        return ProcessTools.executeTestJava(args)
  90                 .outputTo(System.out)
  91                 .errorTo(System.out)
  92                 .getExitValue();

</pre><hr></hr><pre>
 241         assertTrue(rc == 0);
 242 
 243         // java --module-path mods -m $TESTMODULE
 244         int exitValue = exec("--module-path", dir.toString(), "-m", TEST_MODULE);
 245         assertTrue(exitValue != 0);
 246     }
 247 
 248 
 249     /**
 250      * Attempt to run with -m specifying a main class that is a different
 251      * module to that specified to -m
 252      */
 253     public void testTryRunWithMainClassInWrongModule() throws Exception {
 254         String modulepath = MODS_DIR.toString();
 255         String mid = "java.base/" + MAIN_CLASS;
 256 
 257         // java --module-path mods --module $TESTMODULE/$MAINCLASS
 258         int exitValue = exec("--module-path", modulepath, "--module", mid);
 259         assertTrue(exitValue != 0);
 260     }



















































 261 
 262 }
</pre></td><td><pre>

</pre><hr></hr><pre>
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 /**
  25  * @test
  26  * @library /test/lib
  27  * @modules jdk.compiler
  28  *          jdk.jartool
  29  *          jdk.jlink
  30  * @build BasicTest jdk.test.lib.compiler.CompilerUtils
  31  * @run testng BasicTest
<span class="new">  32  * @bug 8234076</span>
  33  * @summary Basic test of starting an application as a module
  34  */
  35 
  36 import java.io.File;
  37 import java.nio.file.Files;
  38 import java.nio.file.Path;
  39 import java.nio.file.Paths;
  40 import java.util.spi.ToolProvider;
  41 
  42 import jdk.test.lib.compiler.CompilerUtils;
  43 import jdk.test.lib.process.ProcessTools;
<span class="new">  44 import jdk.test.lib.Utils;</span>
  45 
  46 import org.testng.annotations.BeforeTest;
  47 import org.testng.annotations.Test;
  48 import static org.testng.Assert.*;
  49 
  50 
  51 @Test
  52 public class BasicTest {
  53     private static final ToolProvider JAR_TOOL = ToolProvider.findFirst("jar")
  54         .orElseThrow(() -&gt;
  55             new RuntimeException("jar tool not found")
  56         );
  57     private static final ToolProvider JMOD_TOOL = ToolProvider.findFirst("jmod")
  58         .orElseThrow(() -&gt;
  59             new RuntimeException("jmod tool not found")
  60         );
  61 
  62     private static final Path USER_DIR = Paths.get(System.getProperty("user.dir"));
  63 
  64     private static final String TEST_SRC = System.getProperty("test.src");
  65 
  66     private static final Path SRC_DIR = Paths.get(TEST_SRC, "src");
  67     private static final Path MODS_DIR = Paths.get("mods");
  68 
  69     // the module name of the test module
  70     private static final String TEST_MODULE = "test";
  71 
  72     // the module main class
  73     private static final String MAIN_CLASS = "jdk.test.Main";
  74 
<span class="new">  75     // for Windows specific launcher tests</span>
<span class="new">  76     static final boolean IS_WINDOWS = System.getProperty("os.name", "unknown").startsWith("Windows");</span>
  77 
  78     @BeforeTest
  79     public void compileTestModule() throws Exception {
  80 
  81         // javac -d mods/$TESTMODULE src/$TESTMODULE/**
  82         boolean compiled
  83             = CompilerUtils.compile(SRC_DIR.resolve(TEST_MODULE),
  84                                     MODS_DIR.resolve(TEST_MODULE));
  85 
  86         assertTrue(compiled, "test module did not compile");
  87     }
  88 
  89     /**
  90      * Execute "java" with the given arguments, returning the exit code.
  91      */
  92     private int exec(String... args) throws Exception {
  93        return ProcessTools.executeTestJava(args)
  94                 .outputTo(System.out)
  95                 .errorTo(System.out)
  96                 .getExitValue();

</pre><hr></hr><pre>
 245         assertTrue(rc == 0);
 246 
 247         // java --module-path mods -m $TESTMODULE
 248         int exitValue = exec("--module-path", dir.toString(), "-m", TEST_MODULE);
 249         assertTrue(exitValue != 0);
 250     }
 251 
 252 
 253     /**
 254      * Attempt to run with -m specifying a main class that is a different
 255      * module to that specified to -m
 256      */
 257     public void testTryRunWithMainClassInWrongModule() throws Exception {
 258         String modulepath = MODS_DIR.toString();
 259         String mid = "java.base/" + MAIN_CLASS;
 260 
 261         // java --module-path mods --module $TESTMODULE/$MAINCLASS
 262         int exitValue = exec("--module-path", modulepath, "--module", mid);
 263         assertTrue(exitValue != 0);
 264     }
<span class="new"> 265 </span>
<span class="new"> 266     /**</span>
<span class="new"> 267      * Helper method that creates a ProcessBuilder with command line arguments</span>
<span class="new"> 268      * while setting the _JAVA_LAUNCHER_DEBUG environment variable.</span>
<span class="new"> 269      */</span>
<span class="new"> 270     private ProcessBuilder createProcessWithLauncherDebugging(String... cmds) {</span>
<span class="new"> 271         ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(Utils.addTestJavaOpts(cmds));</span>
<span class="new"> 272         pb.environment().put("_JAVA_LAUNCHER_DEBUG", "true");</span>
<span class="new"> 273 </span>
<span class="new"> 274         return pb;        </span>
<span class="new"> 275     }</span>
<span class="new"> 276 </span>
<span class="new"> 277     /**</span>
<span class="new"> 278      * Test the ability for the Windows launcher to detect that the first app </span>
<span class="new"> 279      * argument launcher index is -1 when all passed in command line arguments are </span>
<span class="new"> 280      * prefixed with a dash. </span>
<span class="new"> 281      * </span>
<span class="new"> 282      * These tests are not expected to work on *nixes, and are ignored.</span>
<span class="new"> 283      */</span>
<span class="new"> 284     public void testForNegativeArgumentIndex() throws Exception {</span>
<span class="new"> 285         if (!IS_WINDOWS) {</span>
<span class="new"> 286             return;</span>
<span class="new"> 287         }</span>
<span class="new"> 288 </span>
<span class="new"> 289         String dir = MODS_DIR.toString();</span>
<span class="new"> 290         String mid = TEST_MODULE + "/" + MAIN_CLASS;</span>
<span class="new"> 291 </span>
<span class="new"> 292         // java --module-path=mods -module=$TESTMODULE/$MAINCLASS --help</span>
<span class="new"> 293         // When the first app arg index isn't found we will not perform argument expansion</span>
<span class="new"> 294         ProcessTools.executeProcess(</span>
<span class="new"> 295             createProcessWithLauncherDebugging(</span>
<span class="new"> 296                 "--module-path=" + dir,</span>
<span class="new"> 297                 "--module=" + mid,</span>
<span class="new"> 298                 "--help"))</span>
<span class="new"> 299             .outputTo(System.out)</span>
<span class="new"> 300             .errorTo(System.out)</span>
<span class="new"> 301             .shouldContain("Warning: first app arg index not found, -1")</span>
<span class="new"> 302             .shouldNotContain("F--help");</span>
<span class="new"> 303 </span>
<span class="new"> 304         // java --module-path=mods -module $TESTMODULE/$MAINCLASS --help</span>
<span class="new"> 305         // When we find the first app argument correctly, argument expansion is performed</span>
<span class="new"> 306         ProcessTools.executeProcess(</span>
<span class="new"> 307             createProcessWithLauncherDebugging(</span>
<span class="new"> 308                 "--module-path=" + dir,</span>
<span class="new"> 309                 "--module", mid,</span>
<span class="new"> 310                 "--help"))</span>
<span class="new"> 311             .outputTo(System.out)</span>
<span class="new"> 312             .errorTo(System.out)</span>
<span class="new"> 313             .shouldContain("points to --help")</span>
<span class="new"> 314             .shouldContain("F--help");</span>
<span class="new"> 315     } </span>
 316 
 317 }
</pre></td>
</tr></table>
<center><a href='../../../../../../src/java.base/windows/native/libjli/java_md.c.sdiff.html' target='_top'>&lt prev</a> <a href='../../../../../../index.html' target='_top'>index</a> next &gt</center>
</body></html>
